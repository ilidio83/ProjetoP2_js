
<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Mensagens</title>
<link rel="stylesheet" href="css/default.css">
<script src="js/jquery-3.6.4.min.js"></script>
<script src="js/api.js"></script>

</head>
<body>

<div class="page">
  <h2>Mensagens Recebidas</h2>

  <table border="1" width="100%">
      <thead>
          <tr>
              <th>Nome</th>
              <th>Email</th>
              <th>Mensagem</th>
              <th>Ações</th>
          </tr>
      </thead>
      <tbody id="lista"></tbody>
  </table>
</div>

<script>
function carregarMensagens() {
    var mensagensAPI = obterMensagens();
    var local = JSON.parse(localStorage.getItem("mensagensLocais") || "[]");

    // Se ainda não existe nada no localStorage, salva a primeira vez
    if (local.length === 0) {
        mensagensAPI.forEach(m => m.visualizada = false);
        localStorage.setItem("mensagensLocais", JSON.stringify(mensagensAPI));
        local = mensagensAPI;
    }

    // Renderizar a tabela
    var html = "";
    local.forEach(function(m, i){
        var estilo = m.visualizada ? "" : "font-weight:bold;";
        html += `
            <tr style="${estilo}">
                <td>${m.nome}</td>
                <td>${m.email}</td>
                <td>${m.mensagem}</td>
                <td>
                    <button onclick="marcar(${i})">Mensagem Visualizada</button>
                    <button onclick="excluir(${i})">Excluir Mensagem</button>
                </td>
            </tr>
        `;
    });

    $("#lista").html(html);
}

function salvarLocal(mensagens){
    localStorage.setItem("mensagensLocais", JSON.stringify(mensagens));
}

function marcar(i){
    if(confirm("Marcar esta mensagem como visualizada?")){
        var mensagens = JSON.parse(localStorage.getItem("mensagensLocais") || "[]");
        mensagens[i].visualizada = true;
        salvarLocal(mensagens);
        carregarMensagens();
    }
}

function excluir(i){
    if(confirm("Deseja realmente excluir esta mensagem?")){
        var mensagens = JSON.parse(localStorage.getItem("mensagensLocais") || "[]");
        mensagens.splice(i, 1);
        salvarLocal(mensagens);
        carregarMensagens();
    }
}

// Inicializa a página
carregarMensagens();
</script>

</body>
</html>